---
import BlogPost from '../../layouts/BlogPost.astro';
import { getAllSlugs, getPostBySlug } from '../../lib/content';
import { getImageSrc } from '../../lib/image';

export async function getStaticPaths() {
	const slugs = await getAllSlugs();
	return slugs.map((slug: string) => ({
		params: { slug },
	}));
}

const { slug } = Astro.params;
const result = await getPostBySlug(slug!);

if (!result) {
	return Astro.redirect('/404');
}

const { post, data } = result;
const { Content } = await post.render();

const postData = {
	title: data.title,
	description: data.excerpt || '',
	pubDate: data.publishedAt,
	updatedDate: data.updatedAt,
	heroImage: data.cover ? getImageSrc(data.cover) : undefined,
	tags: data.tags,
	currentPostSlug: data.slug,
};
---

<BlogPost {...postData}>
	<Content />
</BlogPost>
